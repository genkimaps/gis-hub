{% ckan_extends %}

{# Hide license #}
{%- block resource_license -%}
{%- endblock -%}

{% block resource_fields %}
{%- for group in schema.resource_fields|groupby('display_group') -%}
    {%- set group_fields = h.non_empty_fields(group.list|list, res, exclude_fields) -%}
    {% if group_fields %}
        <div class="additional-info">
            <h3 class="dataset-group-label">{{ group.grouper }}</h3>
            <dl>
                {% for field in group_fields %}
                    {# Debug fields
                        <p>{{ field }}</p>
                    #}
                    {% if field.field_name == "attribute" %}
                    {% set group_data = h.scheming_composite_load(res[field.field_name]) %}
                    <p>{{ group_data }}</p>
                    <p>{{ field.subfields }}</p>
                        {# Close dl tag and write table header #}
                        </dl>
                        <table class="table">
                            <thead>
                            <tr>
                                {# <th scope="col">Field</th> #}
                                <th scope="col">Field Name</th>
                                <th scope="col">Type</th>
                                <th scope="col">Description</th>
                                <th scope="col">Units</th>
                                <th scope="col">Coded Values</th>
                            </tr>
                            </thead>

                            <tbody>
                            {% for g in group_data %}
                            <tr>
                                <th scope="row">{{ g.column_name }}</th>
                                <td>{{ g.column_type }}</td>
                                <td>{{ g.description }}</td>
                                <td>{{ g.units }}</td>
                                <td>{{ g.coded_values }}</td>
                            </tr>
                            {% endfor %}

                            </tbody>

                        </table>
                        <dl>
                    {% endif %}

                        <dt class="dataset-label">
                            {{ h.scheming_language_text(field.label) }}
                        </dt>
                        {# Add another class if composite #}
                        {%- if field.subfields -%}
                            <dd class="dataset-details composite-holder test78">
                        {%- else -%}
                            <dd class="dataset-details">
                        {%- endif -%}
                            {%- snippet 'scheming/snippets/display_field.html',
                                field=field,
                                data=res,
                                entity_type='dataset',
                                object_type=dataset_type -%}
                        </dd>
                    {#  {% endif %}  #}
                {% endfor %}
            </dl>
        </div>
    {% endif %}
{% endfor %}
{% endblock %}