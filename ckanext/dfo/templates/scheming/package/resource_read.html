{% ckan_extends %}

{# Hide license #}
{%- block resource_license -%}
{%- endblock -%}

{% block resource_fields %}
{# Customize what is displayed for an upload resource #}
{%- if res.url_type == 'upload' -%}
<p>This resource is the uploaded data placeholder for the dataset "{{ pkg.title }}."  To download the data, click the
    Download button at the top-right. To replace the uploaded file, click Manage, then remove the existing file
    under the Upload Data section, and upload a new version of the file. </p>
{%- endif -%}
{%- set upload_res_groups = ['General', 'Upload Data'] -%}
{#  {%- for group in schema.resource_fields|groupby('display_group')  #}
{%- for group in schema.resource_fields|groupby('display_group') if not res.url_type or (res.url_type == 'upload' and group.grouper in upload_res_groups) -%}
    {%- set group_fields = h.non_empty_fields(group.list|list, res, exclude_fields) -%}
    {% if group_fields %}
        <div class="additional-info">
            <h3 class="dataset-group-label">{{ group.grouper }}</h3>
            <dl>
                {% for field in group_fields %}

                    {% if field.field_name == "attribute" %}
                        {% set field_data = h.scheming_composite_load(res[field.field_name]) %}
                        {# Display attributes as a table
                        <p>{{ field_data }}</p>
                        <p>{{ field.subfields }}</p> #}
                        {# Close dl tag and write table header #}
                        </dl>
                        <table class="table">
                            <thead>
                            <tr>
                                <th scope="col" style="width:20%">Field Name</th>
                                <th scope="col" style="width:15%">Type</th>
                                <th scope="col" style="width:35%">Description</th>
                                <th scope="col" style="width:10%">Units</th>
                                <th scope="col" style="width:20%">Coded Values</th>
                            </tr>
                            </thead>

                            <tbody>
                            {% for f in field_data %}
                            <tr>
                                <th scope="row">{{ f.column_name }}</th>
                                <td>{{ f.column_type }}</td>
                                <td>{{ f.description }}</td>
                                <td>{{ f.units }}</td>
                                <td>{{ f.coded_values }}</td>
                            </tr>
                            {% endfor %}

                            </tbody>

                        </table>
                        <dl>
                    {% else %}

                        <dt class="dataset-label">
                            {{ h.scheming_language_text(field.label) }}
                        </dt>
                        {# Add another class if composite #}
                        {%- if field.subfields -%}
                            <dd class="dataset-details composite-holder">
                        {%- else -%}
                            <dd class="dataset-details">
                        {%- endif -%}
                            {%- snippet 'scheming/snippets/display_field.html',
                                field=field,
                                data=res,
                                entity_type='dataset',
                                object_type=dataset_type -%}
                        </dd>
                    {% endif %}
                {% endfor %}
            </dl>
        </div>
    {% endif %}
{% endfor %}
{% endblock %}